<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy 18th Kashvi! üíô</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script async src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    <style>
        :root { --primary-blue: #00d4ff; --deep-space: #010103; }
        body { margin: 0; padding: 0; background: var(--deep-space); font-family: 'Georgia', serif; color: white; overflow-x: hidden; }

        #overlay, #finale-popup {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 2000; transition: opacity 1s ease; text-align: center;
        }
        
        #overlay { background: radial-gradient(circle at center, #001d3d 0%, #000000 100%); }
        
        #finale-popup { 
            background: rgba(0, 0, 0, 0.9); 
            display: none; opacity: 0; z-index: 3000;
            pointer-events: none;
        }

        #countdown { display: flex; margin: 15px 0; color: var(--primary-blue); font-family: sans-serif; }
        .timer-unit { margin: 0 10px; }
        .timer-num { font-size: 2rem; font-weight: bold; display: block; }

        button {
            padding: 14px 35px; border-radius: 50px; border: none; font-weight: bold;
            letter-spacing: 2px; transition: 0.4s; cursor: pointer;
            background: var(--primary-blue); color: white; box-shadow: 0 0 25px var(--primary-blue);
        }

        .collage { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; 
            margin: 40px 0; width: 100%; max-width: 900px; padding: 0 15px;
        }
        
        .img-card { position: relative; cursor: pointer; text-align: center; }
        
        .collage img { 
            width: 100%; border-radius: 15px; border: 2px solid rgba(0, 212, 255, 0.1); 
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            filter: grayscale(100%) brightness(0.5);
        }
        
        .img-card.unlocked img { filter: grayscale(0%) brightness(1.2); border-color: var(--primary-blue); transform: scale(1.08); box-shadow: 0 0 20px var(--primary-blue); }

        .typewriter-box {
            min-height: 80px; margin-top: 15px; font-size: 0.85rem; line-height: 1.5;
            color: #bde0fe; text-shadow: 0 0 5px rgba(0, 212, 255, 0.5);
            font-style: italic;
        }

        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
        .content-scroll { position: relative; z-index: 10; width: 100%; display: none; flex-direction: column; align-items: center; }
        .container { text-align: center; padding: 100vh 20px 50px 20px; width: 95%; }

        .finale-text {
            font-size: 3.5rem; color: var(--primary-blue);
            text-shadow: 0 0 30px var(--primary-blue);
            font-weight: bold; animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
    </style>
</head>
<body>

<div id="overlay">
    <div id="countdown">
        <div class="timer-unit"><span class="timer-num" id="days">00</span><span>Days</span></div>
        <div class="timer-unit"><span class="timer-num" id="hours">00</span><span>Hrs</span></div>
        <div class="timer-unit"><span class="timer-num" id="mins">00</span><span>Mins</span></div>
        <div class="timer-unit"><span class="timer-num" id="secs">00</span><span>Secs</span></div>
    </div>
    <button id="entryBtn">OPEN KASHVI'S GIFT üíô</button>
</div>

<div id="finale-popup">
    <div class="finale-text">HAPPY BIRTHDAY<br>KASHVI! üßøüíô</div>
    <p style="margin-top: 20px; font-size: 1.2rem;">Welcome to 18.</p>
</div>

<div id="canvas-container"></div>

<div class="content-scroll" id="mainContent">
    <div class="container">
        <h1 style="color: var(--primary-blue); font-size: 2.2rem; margin-bottom: 10px;">For Kashvi üßø</h1>
        <p style="opacity: 0.7; margin-bottom: 30px;">Tap each memory to reveal the letter...</p>
        
        <div class="collage">
            <div class="img-card" onclick="typeWriterReveal(this, 0)"><img src="1.jpeg"><div class="typewriter-box" id="text-0"></div></div>
            <div class="img-card" onclick="typeWriterReveal(this, 1)"><img src="2.jpeg"><div class="typewriter-box" id="text-1"></div></div>
            <div class="img-card" onclick="typeWriterReveal(this, 2)"><img src="3.jpeg"><div class="typewriter-box" id="text-2"></div></div>
            <div class="img-card" onclick="typeWriterReveal(this, 3)"><img src="4.jpeg"><div class="typewriter-box" id="text-3"></div></div>
            <div class="img-card" onclick="typeWriterReveal(this, 4)"><img src="5.jpeg"><div class="typewriter-box" id="text-4"></div></div>
            <div class="img-card" onclick="typeWriterReveal(this, 5)"><img src="6.jpeg"><div class="typewriter-box" id="text-5"></div></div>
        </div>
        <footer>SMEET X KASHVI | 2026</footer>
    </div>
</div>

<audio id="bgMusic" loop><source src="birthday-song.mp3" type="audio/mpeg"></audio>

<script>
    const fullMessage = [
        "Happy Birthday to someone who makes even the most ordinary days feel lighter. From the laughs we somehow always find in labs, to sharing earphones and working together‚Äîit‚Äôs always just easy with you. ü§ç",
        "From finishing each other‚Äôs assignments, correcting mistakes, helping through quizzes, to mocking and competing in the healthiest way, every moment feels like teamwork at its best. üß™",
        "Add in the random tickles and cheek-pulling that end in uncontrollable laughter, and it‚Äôs impossible not to smile around you. You have a way of making everything fun. üòÇ",
        "You‚Äôve had my back quietly‚Äîkeeping things discreet when needed, guiding me toward better choices, and pushing me to improve without ever making it feel heavy. ü´Ç",
        "Even on the days you said ‚ÄúI‚Äôm okay‚Äù when you weren‚Äôt, you still showed up with strength and care. I see your strength and I appreciate it more than you know. üí™‚ú®",
        "I‚Äôm genuinely grateful to have you as a friend, and I hope this year gives you all the laughter, wins, and peace you deserve. Happy 18th, Kashvi! üíôüßø"
    ];

    let unlockedCount = 0;

    function typeWriterReveal(card, index) {
        if(card.classList.contains('unlocked')) return;
        card.classList.add('unlocked');
        unlockedCount++;
        
        const targetDiv = document.getElementById(`text-${index}`);
        const text = fullMessage[index];
        let i = 0;

        function type() {
            if (i < text.length) {
                targetDiv.innerHTML += text.charAt(i);
                i++;
                setTimeout(type, 30);
            } else if (unlockedCount === 6) {
                showFinale();
            }
        }
        type();
        confetti({ particleCount: 30, spread: 40, origin: { y: 0.8 }, colors: ['#00d4ff', '#ffffff'] });
    }

    function showFinale() {
        setTimeout(() => {
            const popup = document.getElementById('finale-popup');
            popup.style.display = 'flex';
            setTimeout(() => popup.style.opacity = '1', 10);
            
            // Grand Finale Confetti Cannon
            const duration = 5 * 1000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 4000 };

            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);
                const particleCount = 50 * (timeLeft / duration);
                confetti({...defaults, particleCount, origin: { x: Math.random(), y: Math.random() - 0.2 }});
            }, 250);
        }, 1500);
    }

    const targetDate = new Date("January 20, 2026 00:00:00").getTime();
    function updateCountdown() {
        const dist = targetDate - new Date().getTime();
        document.getElementById("days").innerText = Math.max(0, Math.floor(dist / 86400000));
        document.getElementById("hours").innerText = Math.max(0, Math.floor((dist % 86400000) / 3600000));
        document.getElementById("mins").innerText = Math.max(0, Math.floor((dist % 3600000) / 60000));
        document.getElementById("secs").innerText = Math.max(0, Math.floor((dist % 60000) / 1000));
    }
    setInterval(updateCountdown, 1000);
    updateCountdown();

    document.getElementById('entryBtn').addEventListener('click', () => {
        document.getElementById('overlay').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('mainContent').style.display = 'flex';
        }, 1000);
        document.getElementById('bgMusic').play();
    });
</script>

<script type="module">
    import * as THREE from 'three';
    import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
    import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
    import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.z = 25;
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.getElementById('canvas-container').appendChild(renderer.domElement);

    const composer = new EffectComposer(renderer);
    composer.addPass(new RenderPass(scene, camera));
    composer.addPass(new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 2.2, 0.4, 0.85));

    const PARTICLE_COUNT = 28000;
    const geometry = new THREE.BufferGeometry();
    const pos = new Float32Array(PARTICLE_COUNT * 3);
    const target = new Float32Array(PARTICLE_COUNT * 3);
    const colors = new Float32Array(PARTICLE_COUNT * 3);

    for(let i=0; i<PARTICLE_COUNT; i++) {
        pos[i*3] = (Math.random()-0.5)*100; pos[i*3+1] = (Math.random()-0.5)*100; pos[i*3+2] = (Math.random()-0.5)*100;
        colors[i*3] = 0; colors[i*3+1] = 0.7; colors[i*3+2] = 1;
    }
    geometry.setAttribute('position', new THREE.BufferAttribute(pos, 3));
    geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
    const particles = new THREE.Points(geometry, new THREE.PointsMaterial({ size: 0.07, vertexColors: true, blending: THREE.AdditiveBlending }));
    scene.add(particles);

    let mouseX = 0, mouseY = 0;
    window.addEventListener('mousemove', (e) => { mouseX = (e.clientX - window.innerWidth / 2) / 250; mouseY = (e.clientY - window.innerHeight / 2) / 250; });

    let shapeIdx = 0;
    function morph() {
        for(let i=0; i<PARTICLE_COUNT; i++) {
            const i3 = i*3; const t = (i/PARTICLE_COUNT) * Math.PI * 2;
            let x, y, z;
            if (shapeIdx === 0) { // Infinity
                const scale = 12; x = (scale * Math.cos(t)) / (1 + Math.pow(Math.sin(t), 2)); y = (scale * Math.sin(t) * Math.cos(t)) / (1 + Math.pow(Math.sin(t), 2)); z = (Math.random()-0.5) * 2;
            } else if (shapeIdx === 1) { // Heart
                x = 16 * Math.pow(Math.sin(t), 3) * 0.6; y = (13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t)) * 0.6; z = (Math.random()-0.5) * 4;
            } else if (shapeIdx === 2) { // DNA
                x = Math.cos(t * 10) * 6; z = Math.sin(t * 10) * 6; y = (i/PARTICLE_COUNT)*30 - 15;
            } else if (shapeIdx === 3) { // Star
                const r = i % 2 === 0 ? 12 : 6; x = Math.cos(t * 5) * r; y = Math.sin(t * 5) * r; z = (Math.random()-0.5) * 3;
            } else if (shapeIdx === 4) { // Sphere
                const phi = Math.acos(-1 + (2 * i) / PARTICLE_COUNT); const theta = Math.sqrt(PARTICLE_COUNT * Math.PI) * phi; x = 11 * Math.cos(theta) * Math.sin(phi); y = 11 * Math.sin(theta) * Math.sin(phi); z = 11 * Math.cos(phi);
            } else if (shapeIdx === 5) { // Torus
                x = (9 + 3 * Math.cos(t * 3)) * Math.cos(t * 2); y = (9 + 3 * Math.cos(t * 3)) * Math.sin(t * 2); z = 3 * Math.sin(t * 3);
            } else { // Pyramid
                const r = (i/PARTICLE_COUNT) * 16; x = (Math.random()-0.5) * r; z = (Math.random()-0.5) * r; y = 14 - r;
            }
            target[i3] = x; target[i3+1] = y; target[i3+2] = z;
        }
        shapeIdx = (shapeIdx + 1) % 7;
    }

    function animate() {
        requestAnimationFrame(animate);
        const p = geometry.attributes.position.array;
        for(let i=0; i<PARTICLE_COUNT*3; i++) p[i] += (target[i] - p[i]) * 0.04;
        particles.rotation.y += 0.003 + (mouseX * 0.02);
        particles.rotation.x += (mouseY * 0.02);
        geometry.attributes.position.needsUpdate = true;
        composer.render();
    }
    morph(); animate();
    setInterval(morph, 4500);
</script>
</body>
</html>
